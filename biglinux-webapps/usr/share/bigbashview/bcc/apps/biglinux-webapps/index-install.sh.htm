#!/bin/bash

#Translation
export TEXTDOMAINDIR="/usr/share/locale"
export TEXTDOMAIN=biglinux-webapps

if [ "$p_icondesk" = "" ];then

    p_icondesk="/usr/share/bigbashview/bcc/apps/biglinux-webapps/default.png"

else

    p_icon="$p_icondesk"
    
fi

echo '
    <head>
        <title>BigLinux WebApps</title>
        <link rel="stylesheet" type="text/css" href="/usr/share/bigbashview/bcc/materialize/css/materialize.css">
        <link rel="stylesheet" type="text/css" href="app.css">
        <script src="/usr/share/bigbashview/bcc/materialize/js/jquery.js"></script>
        <script src="/usr/share/bigbashview/bcc/materialize/js/materialize.js"></script>
        <script src="/usr/share/bigbashview/bcc/js/big.js"></script>
    </head>
    <body>
        <div id="page2">
            <div id="middle" class="bar">
                <h1>
                    <p>' $"Instalar WebApps BigLinux:" '</p><br>
                    <form action="webapp-install.sh" method="get">
                        <label style="float:left" for="namedesk">'$"Nome do WebApp:"'</label>
                            <div class="row">
                                <input type="text" name="namedesk" id="namedesk" required value="'$p_namedesk'" /><br>
                            </div>
                        <label style="float:left" for="urldesk">'$"Url do WebApp:"'</label><br>
                            <div class="row">
                                <div class="col s8">
                                    <input type="text" name="urldesk" id="urldesk"required value="'$p_urldesk'"/><br>
                                </div>
                                <div class="col s4">
                                    <a style="float:right;width: 175px;" class="button" id="favicon">'$"Pesquisar Ícone"'</a>
                                </div>
                            </div>
                        <label style="float:left" for="icondesk">'$"Ícone do WebApp:"'</label><br><br>
                            <div class="row">
                                <div class="col s2">
                                    <img id="preview" src="'$p_icondesk'" width="48" height="48"/>
                                </div>
                                <div class="col s7">
                                    <input type="text" id="icondesk" name="icondesk" readonly value="'$p_icon'"/>
                                </div>
                                <div class="col s3">
                                    <a style="float:right;width: 120px;" class="button" id="btn">'$"Carregar"'</a>
                                </div>
                            </div><br><br>
                        <a href="index.sh.htm" class="button" style="margin-right:30px;">'$"Início"'</a>
                        <button type="submit" class="button" id="install">'$"Instalar"'</button>
                    </form>
                </h1>
            </div>
        </div>'

        echo "
        <script type='text/javascript'>
        \$(document).ready(function(){
            \$('#btn').click(function(e){
                e.preventDefault();
                \$.get('./icon.sh', function(data) {
                    \$('#icondesk').val(data);
                    \$('#preview').attr('src', data);
                    \$('#btn').html('"$"Alterar""');
                });
            });
            \$('#favicon').click(function(e){
                e.preventDefault();
                \$('#favicon').html('"$"Pesquisando...""');
                var url = \$('#urldesk').val();
                if (url == '') {
                    \$('#urldesk').val('"$"Url precisa ser inserida corretamente!""');
                }
                \$.get('./fav.sh', url, function(data) {
                    \$('#icondesk').val(data);
                    \$('#preview').attr('src', data);
                    \$('#favicon').html('"$"Pesquisar Ícone""');
                    \$('#btn').html('"$"Alterar""');
                });
            });

        });
        </script>
    </body>"


